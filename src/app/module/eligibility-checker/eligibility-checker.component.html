<div class="eligibility-checker-container" [@fadeInAnimation]>
  <h1>Loan Eligibility Checker</h1>
  <p>Check your loan eligibility quickly and easily.</p>

  <form class="eligibility-form" (ngSubmit)="onSubmit(eligibilityForm)" #eligibilityForm="ngForm">
    <div class="moving-note-wrapper">
      <p class="moving-note-text">
        âš ï¸ This tool provides a highly reliable estimate of your loan eligibility based on the details you enter. While it's not definitive, it aims to offer the most accurate results possible.

      </p>
    </div>
    
    <!-- Row 1: Loan Type -->
    <div class="loan_type_row justify-end">
      <div class="refers-icon">
        <img src="assets/icons/refers_right.png" alt="Loan Type Icon" loading="lazy" />
      </div>

      <div class="form-group ">
    
        <label for="loanType" class="label-with-icon">
          Loan Type:
          <img src="assets/icons/loan_type.png" alt="Loan Type Icon" loading="lazy" />
        </label>
        <input
          type="text"
          id="loanType"
          [formControl]="loanTypeControl"
          [matAutocomplete]="auto"
          placeholder="Select a loan type"
          required
          class="input-field"
          aria-required="true"
        />
        <mat-autocomplete #auto="matAutocomplete" (optionSelected)="onLoanTypeSelected($event)">
          <mat-option *ngFor="let option of filteredLoanTypes | async" [value]="option.viewValue">
            {{ option.viewValue }}
          </mat-option>
        </mat-autocomplete>
        <div class="error-message" *ngIf="loanTypeControl.touched && loanTypeControl.hasError('required')">
          Loan type is required.
        </div>
        
      </div>
    </div>
  
    <!-- Row 2: Monthly Salary + Loan Amount -->
    <div class="form-row">
      <div class="form-group half-width">
        <label for="monthlySalary" class="label-with-icon">Monthly Salary (â‚¹):
          <img src="assets/icons/monthly_loan.png" alt="Monthly Salary Icon" loading="lazy" />
        </label>
        <input
          type="number"
          id="monthlySalary"
          name="monthlySalary"
          [(ngModel)]="monthlySalary"
          required
          min="0"
          class="input-field"
        />
      </div>
      <div class="form-group half-width">
        <label for="loanAmount" class="label-with-icon">Loan Amount (â‚¹):
          <img src="assets/icons/loan_amount.png" alt="Loan Amount Icon" loading="lazy" />
        </label>
        <input
          type="number"
          id="loanAmount"
          name="loanAmount"
          [(ngModel)]="loanAmount"
          required
          min="0"
          class="input-field"
        />
      </div>
    </div>
  
    <!-- Row 3: Loan Tenure + Expenses -->
    <div class="form-row">
      <div class="form-group half-width">
        <label for="tenureMonths" class="label-with-icon">Loan Tenure (months):
          <img src="assets/icons/days.png" alt="Loan Tenure Icon" loading="lazy" />
        </label>
        <input
          type="number"
          id="tenureMonths"
          name="tenureMonths"
          [(ngModel)]="tenureMonths"
          required
          min="1"
          class="input-field"
        />
      </div>
      <div class="form-group half-width">
        <label for="expenses" class="label-with-icon">Existing Emis (â‚¹):
          <img src="assets/icons/emis.png" alt="Existing Emi Icon" loading="lazy" />
        </label>
        <input
          type="number"
          id="expenses"
          name="expenses"
          [(ngModel)]="expenses"
          min="0"
          class="input-field"
        />
      </div>
    </div>
  
    <!-- Row 4: Submit button -->
    <div class="form-row justify-end">
      <button type="submit" [disabled]="!eligibilityForm.form.valid" class="submit-button">
        Check Eligibility
      </button>
    </div>
  </form>
  

  <div class="result" *ngIf="result !== null" [@fadeInAnimation]>
      <h3>Result</h3>
      <div class="result-card">
        <div>
          <p class="explanation" [ngClass]="{'eligible': result.eligible, 'not-eligible': !result.eligible}">
            {{ result.eligible ? 'âœ…' : 'âŒ' }} {{ explanation }}
          </p>
          <p>EMI: â‚¹{{ result.emi | number:'1.2-2' }}</p>
          <p>EMI to Income Ratio: {{ result.ratio | number:'1.2-2' }}%</p>
        </div>
        <div class="app-chart">
          <canvas baseChart [data]="chartData" [type]="chartType" [options]="chartOptions">
          </canvas>
        </div>
      </div>
  </div>

  <div class="explanation-container">
    <section class="card-info">
      <h3>ğŸ§® Key Loan Repayment Metrics</h3>
      <p>We use the formula:</p>
      <div class="formula">
        EMI = [ P Ã— r Ã— (1 + r)<sup>n</sup> ] / [ (1 + r)<sup>n</sup> âˆ’ 1 ]
      </div>
      <ul class="variables">
        <li><strong>P</strong> = Loan Amount</li>
        <li><strong>r</strong> = Monthly Interest Rate (Annual Rate Ã· 12 Ã· 100)</li>
        <li><strong>n</strong> = Tenure in Months</li>
      </ul>

      <div class="example">
        <h4>ğŸ”¹ Example:</h4>
        <p>Loan Amount: â‚¹5,00,000<br>
          Interest Rate: 10% annual<br>
          Tenure: 5 years = 60 months<br>
          Monthly Rate = 10 Ã· 12 Ã· 100 = <strong>0.00833</strong>
        </p>
      </div>
    </section>

    <section class="card-info">
      <h3>ğŸ’° Income Capacity Insights</h3>
      <p>We deduct monthly expenses from your salary to find your net available income:</p>
      <div class="formula">
        Adjusted Income = Monthly Salary âˆ’ Expenses
      </div>
      <div class="example">
        <h4>ğŸ”¸ Example:</h4>
        <p>Monthly Salary: â‚¹60,000<br>
          Expenses: â‚¹15,000<br>
          Adjusted Income = â‚¹60,000 âˆ’ â‚¹15,000 = <strong>â‚¹45,000</strong>
        </p>
      </div>
    </section>

    <section class="card-info">
      <h3>ğŸ“Œ Affordability Threshold Check</h3>
      <p>We check if EMI is less than or equal to 50% of your adjusted income:</p>
      <div class="formula">
        Ratio = ( EMI / Adjusted Income ) Ã— 100
      </div>
      <p>If <strong>Ratio â‰¤ 50%</strong>, you're eligible.</p>

      <div class="example">
        <h4>ğŸ”¹ Example:</h4>
        <p>EMI: â‚¹20,000<br>
          Adjusted Income: â‚¹45,000<br>
          Ratio = ( â‚¹20,000 / â‚¹45,000 ) Ã— 100 = <strong>44.4%</strong><br>
          â¤ You are eligible ğŸ‰
        </p>
      </div>
    </section>
  </div>

</div>
